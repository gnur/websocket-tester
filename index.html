<html>
<head>
<title>Chat Example</title>
<link rel="stylesheet" type="text/css" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.6/themes/cupertino/jquery-ui.css" />
<script type='text/javascript' src='http://code.jquery.com/jquery-1.5.js'></script>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.7/jquery-ui.js"></script>
<script type="text/javascript">
function createWindow(){
    var aantal = ws.windows.length;
    var newwindow = aantal + 1;
    console.log(newwindow);
    var newwindowhtml = ws.windowhtml.replace("##NUMBER##", newwindow).replace("##NUMBER##", newwindow).replace("##NUMBER##", newwindow).replace("##NUMBER##", newwindow);
    var newdiv = $(newwindowhtml);
    ws.windows.push(newdiv);
    $("body").append($(newwindowhtml));
    $("#websock" + newwindow).resizable();
    $("#websock" + newwindow).draggable({ stack: ".sockwindow"});
}

    var conn;
    var msg = $("#msg");
    var log = $("#log");
    msg.focus();

    function appendLog(msg) {
        var d = log[0]
        var doScroll = d.scrollTop == d.scrollHeight - d.clientHeight;
        msg.appendTo(log)
        if (doScroll) {
            d.scrollTop = d.scrollHeight - d.clientHeight;
        }
    }

    $("#form").submit(function() {
        if (!conn) {
            connect(msg.val());
            return false;
        }
        if (!msg.val()) {
            return false;
        }
        conn.send(msg.val());
        msg.val("");
        return false
    });

    function connect(url) {
        if (window["WebSocket"]) {
            conn = new WebSocket("ws://" + url);
            conn.onopen = function(evt) {
                appendLog($("<div><strong>Connection opened..</strong></div>"));
            };
            conn.onclose = function(evt) {
                appendLog($("<div><b>Connection closed.</b></div>"));
                conn = false;
            };
            conn.onmessage = function(evt) {
                appendLog($("<div/>").text(evt.data))
            };
        } else {
            appendLog($("<div><b>Your browser does not support WebSockets.</b></div>"));
        }
    }
$(function() {
    ws = {};
    ws.windows = [];
    ws.windowhtml = "<div id=websock##NUMBER## class=sockwindow><div class=log id=log##NUMBER##></div><form class=form id=form##NUMBER##><table cellpadding=0 cellspacing=0 width=100%><tr><td style='width:20px;'><input type=submit /></td><td><input type=text class=command id=msg##NUMBER## /></td></tr></table></form></div>";

    $("#newwindow").click(function() {
        createWindow();
        console.log("creating new");
        return false;
    });
});
</script>
<style type="text/css">
body {
    background: #222;
}
.log {
    background: white;
    margin: 0;
    padding: 5px;
    position:absolute;
    top: 10px;
    left: 10px;
    right: 10px;
    bottom: 40px;
    overflow: auto;
}
.form {
    padding: 5px;
    margin: 0;
    position:absolute;
    bottom: 5px;
    left: 0px;
    right: 5px;
    height: 25px;
    overflow: hidden;
}
.sockwindow {
    float: left;
    position: relative;
    background: #eee;
    width: 400px;
    height: 400px;
}
.command {
    width: 100%;
}

</style>
</head>
<body>
<a href="" id=newwindow>new socketwindow</a>

<div id=websock##NUMBER## class=sockwindow>
<div class=log id=log##NUMBER##></div>
<form class=form id=form##NUMBER##>
    <table cellpadding=0 cellspacing=0 width=100%>
        <tr>
            <td style="width:20px;"><input type="submit" /></td>
            <td><input type="text" class=command id=msg##NUMBER## /></td>
        </tr>
    </table>
</form>
</div>

</body>
</html>
